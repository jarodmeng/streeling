---
title: Stars and bars and prisoners
author: Jarod Meng
date: '2017-09-19'
categories:
  - Maths
tags:
  - combinatorics
slug: stars-and-bars-and-prisoners
---



<p>One of my friends posted an interesting brain teaser on WeChat. It was in Mandarin, so here is a loose translation of the question.</p>
<blockquote>
<p>Suppose there are 100 prisoners. All of them are in solitary confinement so they cannot talk to each other at all. The warden has designed a “game”. He prepares an empty room with only a lamp inside. The lamp is initially switched off. Each time he takes a single prisoner into the room. The prisoner can choose to turn on/off the lamp and do nothing else. Each prisoner can be taken multiple times. The “game” is that each time before a prisoner is about to leave the room, he can make an assertion that all 100 prisoners have been to the room at least once. If the assertion is indeed true, all prisoners are released. If not, all of them are executed. The prisoners can have a meeting to set a strategy. What’s the strategy?</p>
</blockquote>
<p>My initial approach is to try to use the lamp as a counter since that’s the only communication device accessible by all prisoners. That turns out to be very difficult since the lamp is basically just a binary switch with no memory.</p>
<p>Before I spend serious brain power to design a clever way of using the switch to signal the event that all prisoners have been to the room at least once, I thought I should compute the probability of the event itself.</p>
<p>The probability question can be abstracted to a combinatorics problem. That is, if each prisoner has equal probability of being taken to the room and a prisoner can be taken multiple times, how many times the warden needs to take prisoners to the room for every prisoner to have been taken at least once.</p>
<p>More precisely, the prisoners who have been taken to the room after <span class="math inline">\(k\)</span> times form a <span class="math inline">\(k\)</span>-element <a href="https://en.wikipedia.org/wiki/Multiset">multiset</a> from an <span class="math inline">\(n\)</span>-element unique set (in this case, <span class="math inline">\(n=100\)</span>). The probability can then be computed as <strong>the number of multisets that contain all <span class="math inline">\(n\)</span> elements from the unique set divided by the total number of possible multisets</strong>.</p>
<div id="combination" class="section level2">
<h2>Combination</h2>
<p>Since the order of the prisoners doesn’t matter, the problem is a <a href="https://en.wikipedia.org/wiki/Combination">combination</a> question. In conventional combinations, the number of <span class="math inline">\(k\)</span>-combinations of a <span class="math inline">\(n\)</span>-element set (<span class="math inline">\(k \leq n\)</span>) is equal to the binomial coefficient <span class="math inline">\({{n}\choose{k}} = \frac{n!}{k!(n-k)!} = \frac{n(n-1)...(n-k+1)}{k(k-1)...1}\)</span>. For example, there are <span class="math inline">\({{3}\choose{2}} = \frac{3 \times 2}{2 \times 1} = 3\)</span> ways to choose a 2-element tuple from a 3-element set <span class="math inline">\(\{A, B, C\}\)</span>, namely <span class="math inline">\((A, B)\)</span>, <span class="math inline">\((A, C)\)</span>, and <span class="math inline">\((B, C)\)</span>.</p>
<p>Conventional combinations are drawn without repetition. The 3 tuples in the previous example are all unique sets. However, in our prisoner problem, the same prisoner can be taken more than once, so the binomial coefficient doesn’t seem to apply here.</p>
<p>What we need here is a way to <a href="https://en.wikipedia.org/wiki/Multiset#Counting_multisets">count multisets</a>. Formally, the number of multisets of cardinality <span class="math inline">\(k\)</span>, with elements taken from a finite set of cardinality <span class="math inline">\(n\)</span>, is the multiset coefficient, written as <span class="math inline">\(\left(\!\!{n\choose k}\!\!\right)\)</span>.</p>
<p>The value of multiset coefficient can be computed using an equivalent binomial coefficient.</p>
<p><span class="math display">\[\left(\!\!{n\choose k}\!\!\right) = {{n+k-1}\choose{k}} = \frac{(n+k-1)!}{k!(n-1)!}\]</span></p>
<p>To see this equivalence, one can use a simple technique called <a href="https://en.wikipedia.org/wiki/Stars_and_bars_(combinatorics)">stars and bars</a>.</p>
<p>Suppose 3 elements are drawn with repetition from the set <span class="math inline">\({1,2}\)</span> of cardinality 2 (<span class="math inline">\(n=2, k=3\)</span>). It’s not difficult to enumerate all possible multisets because there are only 4 of them: <span class="math inline">\(\{1,1,1\}\)</span>, <span class="math inline">\(\{1,1,2\}\)</span>, <span class="math inline">\(\{1,2,2\}\)</span>, and <span class="math inline">\(\{2,2,2\}\)</span>.</p>
<p>We can also represent those multisets in another form.</p>
<p><span class="math inline">\(\{{\bullet}{\bullet}{\bullet}|\}\)</span>, <span class="math inline">\(\{{\bullet}{\bullet}|{\bullet}\}\)</span>, <span class="math inline">\(\{{\bullet}|{\bullet}{\bullet}\}\)</span>, and <span class="math inline">\(\{|{\bullet}{\bullet}{\bullet}\}\)</span></p>
<p>In this form, all elements are denoted as a dot. Vertical bars are put to divide the dots into bins, with each bin representing an element from the unique set. It’s possible to have a bin with no elements which basically means that the particular unique element doesn’t have any corresponding elements in the multiset (e.g., the first multiset doesn’t have element <span class="math inline">\(2\)</span> and the last multiset doesn’t have <span class="math inline">\(1\)</span>).</p>
<p>One needs <span class="math inline">\(n-1\)</span> bars to represent a unique set of cardinality <span class="math inline">\(n\)</span>. If we count the total number of dots and bars in a <span class="math inline">\(k\)</span>-element multiset, it’s <span class="math inline">\(k+n-1\)</span>. Then the total number of possible <span class="math inline">\(k\)</span>-element multisets equals to the total number of ways of placing <span class="math inline">\(n-1\)</span> bars in <span class="math inline">\(k+n-1\)</span> items, which is <span class="math inline">\({{k+n-1}\choose{n-1}} = {{k+n-1}\choose{k}}\)</span>.</p>
</div>
<div id="the-denominator" class="section level2">
<h2>The denominator</h2>
<p>Let’s return to the original question. What’s the probability of all prisoners being taken to the room at least once after the warden takes <span class="math inline">\(k\)</span> times? To compute this probability, we need to compute the total number of possible scenarios which will serve as the denominator.</p>
<p>The total number should equal to <span class="math inline">\(\left(\!\!{100\choose k}\!\!\right)\)</span>, for a <span class="math inline">\(k \geq 100\)</span>. From the previous section, we can work out <span class="math inline">\(\left(\!\!{100\choose k}\!\!\right) = {{k+100-1}\choose{k}} = {{k+99}\choose{k}}\)</span>.</p>
</div>
<div id="the-numerator" class="section level2">
<h2>The numerator</h2>
<p>The numerator of the probability is the number of multisets in which all prisoners are present at least once. The trick to compute this number is to divide any such multiset into two parts: one set that contains all 100 prisoners and the other with remaining <span class="math inline">\(k-100\)</span> elements. Then the total number of such multisets equals to <span class="math inline">\(\left(\!\!{100\choose k-100}\!\!\right) = {{100+k-100-1}\choose{100-1}} = {{k-1}\choose{99}}\)</span>, for a <span class="math inline">\(k \geq 100\)</span>.</p>
</div>
<div id="the-probability" class="section level2">
<h2>The probability</h2>
<p>Once we have both the denominator and numerator, the probability is straightforward to compute.</p>
<p><span class="math display">\[Pr(E) = \frac{{{k-1}\choose{99}}}{{{k+99}\choose{k}}} = \frac{\frac{(k-1)!}{99! \cdot (k-100)!}}{\frac{(k+99)!}{k! \cdot 99!}} = \frac{k!(k-1)!}{(k+99)!(k-100)!}\]</span></p>
<p>We can plot this probability function for <span class="math inline">\(100 \leq k \leq 200\)</span>.</p>
<pre class="r"><code>Pr &lt;- function(k) {
  choose(k-1, 99)/choose(k+99, k)
}
curve(Pr, from = 100, to = 200, xlab = &quot;k&quot;, ylab = &quot;Pr(E)&quot;)</code></pre>
<p><img src="/post/2017-09-19-stars-and-bars-and-prisoners_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>The plot shows that the probability of getting all prisoners at least once even after the warden takes 200 times is so slim that it’s practically 0.</p>
<p>We can extend the possible <span class="math inline">\(k\)</span> values.</p>
<pre class="r"><code>curve(Pr, from = 100, to = 30000, xlab = &quot;k&quot;, ylab = &quot;Pr(E)&quot;)</code></pre>
<p><img src="/post/2017-09-19-stars-and-bars-and-prisoners_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>For the probability to reach 10%, the warden needs to take nearly 5,000 times. The probability increases a bit faster once <span class="math inline">\(k\)</span> exceeds 5,000, but it still takes about 10,000 times before it gets near 40%.</p>
<p>We can also find out the minimum <span class="math inline">\(k\)</span> that makes the probability greater than 50% (i.e., better than a coin flip).</p>
<pre class="r"><code>for (k in seq(100, 30000, 1)) {
  if (Pr(k) &gt;= 0.5) {
    print(paste0(&quot;It takes &quot;, k, &quot; times for the probability to reach 50%.&quot;))
    break
  }
}</code></pre>
<pre><code>## [1] &quot;It takes 14283 times for the probability to reach 50%.&quot;</code></pre>
<p>Assuming that the warden takes 1 prisoner to the room every day, it would take 39.13 years for the odds to be better than a random coin flip.</p>
<p>How about 80% probability?</p>
<pre class="r"><code>for (k in seq(100, 50000, 1)) {
  if (Pr(k) &gt;= 0.8) {
    print(paste0(&quot;It takes &quot;, k, &quot; times for the probability to reach 80%.&quot;))
    break
  }
}</code></pre>
<pre><code>## [1] &quot;It takes 44367 times for the probability to reach 80%.&quot;</code></pre>
<p>That’s 121.55 years! If that ever happens, the warden has to be the most dedicated warden in history.</p>
</div>
